#!/usr/bin/env python

import sys, optparse

from rasmus import treelib, util
from rasmus.bio import phylo

o = optparse.OptionParser()
o.set_usage("%prog [options] <trees>...")
o.add_option("-s", "--stree", metavar="SPECIES_TREE",
             dest="stree")
o.add_option("-S", "--smap", metavar="GENE_TO_SPECIES_MAP",
             dest="smap")
o.add_option("-c", "--cost", metavar="dup|loss|duploss",
             dest="cost", default="duploss")
             
conf, args = o.parse_args()

if conf.stree is None or conf.smap is None:
    o.print_usage()
    sys.exit(1)

# parse options
stree = treelib.read_tree(conf.stree)
gene2species = phylo.read_gene2species(conf.smap)

for treefile in args:
    print "rerooting %s..." % treefile
    tree = treelib.read_tree(treefile)
    phylo.recon_root(tree, stree, gene2species, 
                     rootby=conf.cost, newCopy=False)
    tree.write(treefile)

